{% extends "admin/base.html" %}
{% load static %}

{% block title %}{{ title }} | äº§å“åº“ç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block branding %}
<h1 id="site-name">
    <a href="{% url 'admin:index' %}">
        ğŸª äº§å“åº“ç®¡ç†ç³»ç»Ÿ
    </a>
</h1>
{% endblock %}

{% block nav-global %}
<div class="nav-global">
    <a href="{% url 'admin:index' %}" class="nav-item {% if request.resolver_match.url_name == 'index' %}active{% endif %}">
        <span class="icon">ğŸ </span> é¦–é¡µ
    </a>
    <a href="{% url 'admin:products_category_changelist' %}" class="nav-item">
        <span class="icon">ğŸ“</span> åˆ†ç±»ç®¡ç†
    </a>
    <a href="{% url 'admin:products_brand_changelist' %}" class="nav-item">
        <span class="icon">ğŸ·ï¸</span> å“ç‰Œç®¡ç†
    </a>
    <a href="{% url 'admin:products_spu_changelist' %}" class="nav-item">
        <span class="icon">ğŸ“¦</span> äº§å“ç®¡ç†
    </a>
    <a href="{% url 'admin:products_attribute_changelist' %}" class="nav-item">
        <span class="icon">âš™ï¸</span> å±æ€§ç®¡ç†
    </a>
    <a href="/pricing-calculator/" class="nav-item">
        <span class="icon">ğŸ§®</span> ä»·æ ¼è®¡ç®—å™¨
    </a>
</div>
{% endblock %}

{% block extrastyle %}
{{ block.super }}
<style>
    /* è‡ªå®šä¹‰æ ·å¼ */
    .nav-global {
        background: rgba(255, 255, 255, 0.1);
        padding: 10px 20px;
        margin: 0 -20px;
        display: flex;
        gap: 20px;
}

    .nav-item {
        color: white;
        text-decoration: none;
        padding: 8px 15px;
        border-radius: 6px;
        transition: background-color 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .nav-item:hover, .nav-item.active {
        background: rgba(255, 255, 255, 0.2);
        color: white;
}

    .nav-item .icon {
        font-size: 16px;
    }
    
    /* å“åº”å¼å¯¼èˆª */
    @media (max-width: 768px) {
        .nav-global {
            flex-wrap: wrap;
            gap: 10px;
}

        .nav-item {
            padding: 6px 10px;
            font-size: 14px;
        }
    }
    
    /* é¡µé¢åŠ è½½åŠ¨ç”» */
    .page-loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 4px;
        background: linear-gradient(90deg, #667eea, #764ba2);
        transform: translateX(-100%);
        animation: loading 2s ease-in-out;
        z-index: 9999;
}

    @keyframes loading {
        0% { transform: translateX(-100%); }
        50% { transform: translateX(0%); }
        100% { transform: translateX(100%); }
}
</style>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="äº§å“åº“ç®¡ç†ç³»ç»Ÿ - é«˜æ•ˆç®¡ç†äº§å“ä¿¡æ¯">
<!-- é¢„åŠ è½½å…³é”®èµ„æº -->
<link rel="preload" href="{% static 'admin/js/enhanced_admin.js' %}" as="script">
<meta name="theme-color" content="#667eea">
{% endblock %}

{% block content %}
<div class="page-loading"></div>
{{ block.super }}
{% endblock %}

{% block footer %}
<div id="footer">
    <div class="footer-content">
        <div class="footer-left">
            <span>Â© 2024 äº§å“åº“ç®¡ç†ç³»ç»Ÿ</span>
        </div>
        <div class="footer-right">
            <span class="version">v2.0.0</span>
            <span class="separator">|</span>
            <span class="user-info">
                æ¬¢è¿ï¼Œ{{ user.get_full_name|default:user.username }}
                {% if user.is_superuser %}
                    <span class="badge badge-admin">ç®¡ç†å‘˜</span>
                {% endif %}
            </span>
        </div>
    </div>
</div>

<style>
    #footer {
        background: #f8f9fa;
        border-top: 1px solid #e9ecef;
        padding: 15px 20px;
        margin-top: 30px;
        color: #6c757d;
        font-size: 14px;
}

    .footer-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
}

    .footer-right {
        display: flex;
        align-items: center;
        gap: 10px;
}

    .badge {
        background: #667eea;
        color: white;
        padding: 2px 6px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: 500;
    }
    
    .separator {
        color: #dee2e6;
}

    @media (max-width: 768px) {
        .footer-content {
            flex-direction: column;
            gap: 10px;
            text-align: center;
        }
}
</style>
{% endblock %}

{% block extrajs %}
{{ block.super }}
<script src="{% static 'admin/js/enhanced_admin.js' %}"></script>
<script>
// é¡µé¢æ€§èƒ½ç›‘æ§
(function() {
    'use strict';
    
    // é¡µé¢å¯è§æ€§API
    document.addEventListener('visibilitychange', function() {
        if (document.visibilityState === 'visible') {
            console.log('é¡µé¢å˜ä¸ºå¯è§');
        } else {
            console.log('é¡µé¢å˜ä¸ºéšè—');
        }
    });
    
    // ç½‘ç»œçŠ¶æ€ç›‘æ§
    window.addEventListener('online', function() {
        if (window.enhancedAdmin) {
            window.enhancedAdmin.showNotification('ç½‘ç»œè¿æ¥å·²æ¢å¤', 'success');
        }
    });
    
    window.addEventListener('offline', function() {
        if (window.enhancedAdmin) {
            window.enhancedAdmin.showNotification('ç½‘ç»œè¿æ¥å·²æ–­å¼€', 'error');
        }
    });
    
    // é”®ç›˜å¿«æ·é”®æç¤º
    let shortcutShown = false;
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === '?' && !shortcutShown) {
            shortcutShown = true;
            showShortcutHelp();
        }
    });
    
    function showShortcutHelp() {
        const shortcuts = [
            'Ctrl+S: ä¿å­˜',
            'Ctrl+Enter: ä¿å­˜å¹¶ç»§ç»­ç¼–è¾‘',
            'Esc: è¿”å›åˆ—è¡¨',
            'Ctrl+?: æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©'
        ];
        
        if (window.enhancedAdmin) {
            window.enhancedAdmin.showNotification(
                'å¿«æ·é”®ï¼š' + shortcuts.join(' | '),
                'info'
            );
        }
        
        setTimeout(() => { shortcutShown = false; }, 5000);
    }
})();

// è‡ªåŠ¨ä¿å­˜è‰ç¨¿åŠŸèƒ½
(function() {
    'use strict';
    
    const formElements = document.querySelectorAll('form input, form textarea, form select');
    const autoSaveKey = 'admin_autosave_' + window.location.pathname;
    
    // åŠ è½½å·²ä¿å­˜çš„æ•°æ®
    function loadAutoSave() {
        try {
            const saved = localStorage.getItem(autoSaveKey);
            if (saved) {
                const data = JSON.parse(saved);
                Object.keys(data).forEach(name => {
                    const element = document.querySelector(`[name="${name}"]`);
                    if (element && element.type !== 'password') {
                        element.value = data[name];
                    }
                });
            }
        } catch (e) {
            console.warn('åŠ è½½è‡ªåŠ¨ä¿å­˜æ•°æ®å¤±è´¥:', e);
        }
    }
    
    // ä¿å­˜æ•°æ®
    function saveAutoSave() {
        try {
            const data = {};
            formElements.forEach(element => {
                if (element.name && element.type !== 'password' && element.type !== 'file') {
                    data[element.name] = element.value;
                }
            });
            localStorage.setItem(autoSaveKey, JSON.stringify(data));
        } catch (e) {
            console.warn('è‡ªåŠ¨ä¿å­˜å¤±è´¥:', e);
        }
    }
    
    // æ¸…é™¤ä¿å­˜çš„æ•°æ®
    function clearAutoSave() {
        localStorage.removeItem(autoSaveKey);
    }
    
    // ç›‘å¬è¡¨å•å˜åŒ–
    formElements.forEach(element => {
        element.addEventListener('input', debounce(saveAutoSave, 1000));
    });
    
    // è¡¨å•æäº¤æ—¶æ¸…é™¤è‡ªåŠ¨ä¿å­˜
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', clearAutoSave);
    });
    
    // é˜²æŠ–å‡½æ•°
    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }
    
    // é¡µé¢åŠ è½½æ—¶æ¢å¤æ•°æ®
    if (formElements.length > 0) {
        loadAutoSave();
    }
})();
</script>
{% endblock %} 