# 🔧 粘贴导入问题排查指南

## 🚨 常见错误及解决方案

### 1. **"Unexpected token '<'" 错误**

**问题描述**：粘贴Markdown表格数据时出现JavaScript解析错误

**可能原因**：
- Markdown表格中的`<br>`标签导致JavaScript解析器混淆
- 表格格式不标准
- 数据中包含特殊字符

**解决方案**：

#### 方案A：使用调试页面
1. 打开调试页面：http://localhost/products/debug-paste/
2. 粘贴您的数据到调试页面
3. 点击"测试数据处理"查看详细错误信息
4. 根据控制台输出调整数据格式

#### 方案B：数据格式优化
确保您的Markdown表格格式正确：

```markdown
| 产品描述 (Description) | 产品编码 (Code) | 系列 (Series) | ... |
| :--- | :--- | :--- | :--- |
| 单门底柜<br>1 door base unit<br>H.720 D.560 | N-U30-7256-L/R | N | ... |
```

**注意事项**：
- 确保每行都以`|`开始和结束
- 确保分隔行包含`---`或`:---`
- 避免在单元格中使用不必要的HTML标签

#### 方案C：使用简化格式
如果Markdown表格仍有问题，可以使用制表符分隔格式：

```
产品描述 (Description)	产品编码 (Code)	系列 (Series)	...
单门底柜	N-U30-7256-L/R	N	...
```

### 2. **数据格式检测问题**

**问题描述**：系统无法识别数据格式

**解决方案**：
1. 确保数据包含正确的格式标识符：
   - Markdown表格：包含`|`和`---`
   - 制表符分隔：包含`\t`字符
   - CSV格式：包含`,`分隔符

2. 检查数据完整性：
   - 确保包含表头行
   - 确保数据行格式一致

### 3. **字段映射问题**

**问题描述**：导入时提示字段不匹配

**解决方案**：
确保使用正确的字段名称（15列标准格式）：

```
产品描述 (Description)
产品编码 (Code)
系列 (Series)
类型代码 (Type_Code)
宽度 (Width_cm)
高度 (Height_cm)
深度 (Depth_cm)
配置代码 (Config_Code)
开门方向 (Door_Swing)
等级Ⅰ
等级Ⅱ
等级Ⅲ
等级Ⅳ
等级Ⅴ
备注 (Remarks)
```

## 🛠️ 调试工具

### 1. **调试页面**
- URL：http://localhost/products/debug-paste/
- 功能：实时测试数据处理
- 特点：详细的控制台输出和错误信息

### 2. **浏览器开发者工具**
1. 按F12打开开发者工具
2. 切换到Console标签
3. 粘贴数据并提交
4. 查看详细的错误信息和调试输出

### 3. **数据验证**
在粘贴前检查数据：
- 行数是否正确
- 列数是否一致
- 特殊字符是否正确转义

## 📋 测试步骤

### 步骤1：基础格式测试
使用最简单的测试数据：

```
| 产品描述 (Description) | 产品编码 (Code) | 系列 (Series) | 类型代码 (Type_Code) | 宽度 (Width_cm) | 高度 (Height_cm) | 深度 (Depth_cm) | 配置代码 (Config_Code) | 开门方向 (Door_Swing) | 等级Ⅰ | 等级Ⅱ | 等级Ⅲ | 等级Ⅳ | 等级Ⅴ | 备注 (Remarks) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 测试产品 | TEST-001 | N | U | 30 | 72 | 56 | - | L/R | - | 1000 | 1100 | 1200 | 1300 | 测试备注 |
```

### 步骤2：复杂数据测试
逐步增加数据复杂度：
- 添加`<br>`标签
- 添加特殊字符
- 添加多行数据

### 步骤3：完整数据测试
使用您的完整数据进行测试

## 🎯 最佳实践

### 1. **数据准备**
- 使用标准的15列格式
- 确保字段名称完全匹配
- 避免不必要的HTML标签

### 2. **分批导入**
- 先测试少量数据（1-3行）
- 确认格式正确后再导入完整数据
- 大批量数据建议分批处理

### 3. **错误处理**
- 仔细阅读错误信息
- 使用调试页面定位问题
- 必要时简化数据格式

## 🔄 备用方案

如果粘贴导入仍有问题，可以使用以下备用方案：

### 方案1：文件上传
1. 将数据保存为CSV文件
2. 使用文件上传功能
3. 选择对应的模板类型

### 方案2：API直接调用
使用curl命令直接调用API：

```bash
curl -X POST "http://localhost/products/ai-data/import/" \
  -H "Content-Type: multipart/form-data" \
  -F "name=测试导入" \
  -F "task_type=products" \
  -F "csv_data=您的CSV数据"
```

### 方案3：数据库直接导入
如果数据量很大，可以考虑直接导入数据库

## 📞 技术支持

如果问题仍然存在，请提供以下信息：
1. 具体的错误信息
2. 浏览器控制台输出
3. 使用的数据格式示例
4. 操作步骤描述

这将帮助快速定位和解决问题。
